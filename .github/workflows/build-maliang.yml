name: Build and Push Maliang Image

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘æ„å»º

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. å…³é”®æ­¥éª¤ï¼šä¸‹è½½ JAR åŒ… (å› ä¸ºæºç é‡Œæ²¡æœ‰)
      # è¿™é‡Œçš„ URL éœ€è¦æ›¿æ¢ä¸ºæœ€æ–°çš„ Release ä¸‹è½½é“¾æ¥
      # ç›®å½•ç»“æ„å‚è€ƒæºæ–‡ä»¶ [3]: deploy/dist/ainovel-server.jar
      - name: Download JAR file
        run: |
          mkdir -p deploy/dist
          # ä¸‹é¢çš„é“¾æ¥æ˜¯ v1.0.0 ç‰ˆæœ¬çš„ç¤ºä¾‹ï¼Œè¯·å» Release é¡µé¢ç¡®è®¤æœ€æ–°é“¾æ¥
          wget -O deploy/dist/ainovel-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          echo "JAR file downloaded successfully."

      # 3. ç™»å½• Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 4. è®¾ç½®æ„å»ºç¯å¢ƒ (QEMU)
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      # 5. è®¾ç½®æ„å»ºå·¥å…· (Buildx)
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 6. æ„å»ºå¹¶æ¨é€
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          # æŒ‡å®š Dockerfile è·¯å¾„ï¼Œå‚è€ƒæºæ–‡ä»¶ [3]
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ä¸º amd64ï¼Œç¡®ä¿ç¾¤æ™–èƒ½è·‘
          platforms: linux/amd64
          # é•œåƒæ ‡ç­¾ï¼šæ‚¨çš„ç”¨æˆ·å/é•œåƒå:ç‰ˆæœ¬å·
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:v1.0.0
4. ç‚¹å‡»å³ä¸Šè§’çš„ Commit changes ä¿å­˜æ–‡ä»¶ã€‚
ç¬¬å››æ­¥ï¼šè§¦å‘æ„å»º
1. ä¿å­˜åï¼Œç‚¹å‡»ä»“åº“é¡¶éƒ¨çš„ Actions é€‰é¡¹å¡ã€‚
2. åœ¨å·¦ä¾§ç‚¹å‡» Build and Push Maliang Imageã€‚
3. ç‚¹å‡»å³ä¾§çš„ Run workflow æŒ‰é’®ã€‚
4. ç­‰å¾…å‡ åˆ†é’Ÿã€‚å½“çŠ¶æ€å˜æˆç»¿è‰²å¯¹å·ï¼ˆâœ…ï¼‰æ—¶ï¼Œè¯´æ˜æ„å»ºæˆåŠŸï¼Œé•œåƒå·²ç»æ¨é€åˆ°æ‚¨çš„ Docker Hub äº†ã€‚
ç¬¬äº”æ­¥ï¼šåœ¨ç¾¤æ™– DSM 6.2 ä¸Šéƒ¨ç½²
ç°åœ¨ï¼Œæ‚¨å·²ç»æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥åœ¨ç¾¤æ™–ä¸Šç›´æ¥ä¸‹è½½çš„é•œåƒäº†ï¼
1. ä¸‹è½½é•œåƒï¼š
    â—¦ æ‰“å¼€ç¾¤æ™– Docker -> æ³¨å†Œè¡¨ã€‚
    â—¦ æœç´¢ æ‚¨çš„Dockerç”¨æˆ·å/maliang-writerã€‚
    â—¦ ä¸‹è½½ v1.0.0 æ ‡ç­¾çš„é•œåƒã€‚
2. å‡†å¤‡ç¯å¢ƒï¼š
    â—¦ åœ¨ File Station åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ /docker/maliangï¼‰ã€‚
    â—¦ ä¸Šä¼  production.env æ–‡ä»¶ï¼ˆä»æºç  deploy/open/production.env.example æ”¹åè€Œæ¥ï¼Œå¹¶ä¿®æ”¹å¥½ API Key å’Œå¯†ç ï¼‰ã€‚
3. å¯åŠ¨å®¹å™¨ï¼š
    â—¦ åœ¨ Docker ä¸­é€‰ä¸­ä¸‹è½½å¥½çš„é•œåƒ -> å¯åŠ¨ã€‚
    â—¦ é«˜çº§è®¾ç½®ï¼š
        â–ª ç«¯å£ï¼šä¸»æœº 18080 -> å®¹å™¨ 18080ã€‚
        â–ª ç¯å¢ƒï¼šæ‰‹åŠ¨æŠŠ production.env é‡Œçš„æ¯ä¸€æ¡å†…å®¹æ·»åŠ è¿›å»ï¼ˆè¿™æ˜¯ DSM 6.2 æœ€ç¨³å¦¥çš„æ–¹å¼ï¼Œæˆ–è€…å°è¯•æŒ‚è½½ env æ–‡ä»¶ï¼‰ã€‚
            â€¢ æ ¸å¿ƒå˜é‡ï¼š SPRING_DATA_MONGODB_URI (å¡« MongoDB åœ°å€), JWT_SECRET, OPENAI_API_KEYã€‚
        â–ª é“¾æ¥ï¼šå¦‚æœæ‚¨è¿˜éƒ¨ç½²äº† MongoDB å®¹å™¨ï¼Œè®°å¾—åœ¨â€œé“¾æ¥â€é€‰é¡¹å¡é‡Œå…³è”å®ƒï¼Œå¹¶å–åˆ«åä¸º mongoã€‚
4. åˆå§‹åŒ–ï¼š
    â—¦ å®¹å™¨å¯åŠ¨åï¼Œä¾ç„¶éœ€è¦é€šè¿‡ SSH è¿›å…¥å®¹å™¨è¿è¡Œ init-admin.sh è„šæœ¬æ¥åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼ˆå‚è€ƒä¹‹å‰çš„æ­¥éª¤ï¼‰ã€‚
é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨æˆåŠŸé¿å¼€äº† DSM 6.2 æ— æ³•æ„å»ºé•œåƒçš„çŸ­æ¿ï¼Œåˆ©ç”¨ GitHub çš„å…è´¹ç®—åŠ›å®Œæˆäº†æœ€å›°éš¾çš„ä¸€æ­¥ã€‚
Run docker/login-action@v2
Error: Username and password required
è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„é…ç½®é”™è¯¯ã€‚æŠ¥é”™ä¿¡æ¯ Error: Username and password required æ„æ€æ˜¯ï¼šGitHub Actions åœ¨è¿è¡Œè„šæœ¬æ—¶ï¼Œå‘ç°ç”¨æ¥ç™»å½• Docker Hub çš„è´¦å·æˆ–å¯†ç æ˜¯ç©ºçš„ã€‚
è¿™é€šå¸¸æ˜¯å› ä¸ºæ‚¨å¿˜è®°åœ¨ GitHub ä»“åº“çš„è®¾ç½®ä¸­æ·»åŠ â€œå¯†é’¥ï¼ˆSecretsï¼‰â€ï¼Œæˆ–è€…å¯†é’¥çš„åç§°ä¸è„šæœ¬é‡Œå†™çš„ä¸ä¸€è‡´ã€‚
è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ£€æŸ¥å¹¶ä¿®å¤ï¼š
1. æ£€æŸ¥ Secrets æ˜¯å¦å·²åˆ›å»º
è¿™æ˜¯æœ€å¸¸è§çš„åŸå› ã€‚è„šæœ¬é‡Œçš„ ${{ secrets.DOCKER_USERNAME }} æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå¿…é¡»å¯¹åº”åˆ°ä»“åº“è®¾ç½®é‡Œçš„çœŸå®å€¼ã€‚
1. å›åˆ°æ‚¨ Fork çš„ MaliangAINovalWriter GitHub ä»“åº“é¡µé¢ã€‚
2. ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªæ çš„ Settings (è®¾ç½®)ã€‚
3. åœ¨å·¦ä¾§ä¾§è¾¹æ æ‰¾åˆ° Secrets and variables -> ç‚¹å‡» Actionsã€‚
4. æŸ¥çœ‹é¡µé¢ä¸­é—´çš„ Repository secretsï¼ˆä»“åº“å¯†é’¥ï¼‰åŒºåŸŸã€‚
    â—¦ æ£€æŸ¥ç‚¹ï¼š è¿™é‡Œå¿…é¡»æœ‰ä¸¤ä¸ªåä¸º DOCKER_USERNAME å’Œ DOCKER_PASSWORD çš„é¡¹ã€‚
    â—¦ å¦‚æœåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œæˆ–è€…åå­—ä¸ä¸€æ ·ï¼ˆæ¯”å¦‚å«æˆäº† DOCKER_USERï¼‰ï¼Œè„šæœ¬å°±ä¼šè¯»ä¸åˆ°å€¼ï¼Œä»è€ŒæŠ¥é”™ã€‚
2. é‡æ–°æ·»åŠ /ä¿®æ­£å¯†é’¥
å¦‚æœå‘ç°ç¼ºå¤±æˆ–åç§°é”™è¯¯ï¼Œè¯·ç«‹å³ç‚¹å‡»å³ä¸Šè§’çš„ New repository secret æŒ‰é’®è¿›è¡Œæ·»åŠ ï¼š
â€¢ ç¬¬ä¸€ä¸ªå¯†é’¥ï¼š
    â—¦ Name: DOCKER_USERNAME
    â—¦ Secret: å¡«å†™æ‚¨çš„ Docker Hub IDï¼ˆæ³¨æ„æ˜¯ IDï¼Œä¸æ˜¯é‚®ç®±ï¼Œé™¤éæ‚¨ç”¨é‚®ç®±ä½œä¸º IDï¼‰ã€‚
â€¢ ç¬¬äºŒä¸ªå¯†é’¥ï¼š
    â—¦ Name: DOCKER_PASSWORD
    â—¦ Secret: å¡«å†™æ‚¨çš„ Docker Hub å¯†ç ï¼ˆæˆ–è€… Access Tokenï¼‰ã€‚
3. æ£€æŸ¥ YAML æ–‡ä»¶æ‹¼å†™
å¦‚æœæ‚¨ç¡®è®¤å¯†é’¥å·²ç»æ·»åŠ äº†ï¼Œé‚£ä¹ˆè¯·æ£€æŸ¥æ‚¨åˆ›å»ºçš„ .yml å·¥ä½œæµæ–‡ä»¶ã€‚
æ‰“å¼€æ‚¨çš„ .github/workflows/build-maliang.yml æ–‡ä»¶ï¼Œæ‰¾åˆ°è¿™ä¸€æ®µï¼š
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}  # ğŸ‘ˆ è¿™é‡Œçš„åå­—å¿…é¡»å’Œè®¾ç½®é‡Œçš„ä¸€æ¨¡ä¸€æ ·
          password: ${{ secrets.DOCKER_PASSWORD }}  # ğŸ‘ˆ è¿™é‡Œçš„åå­—å¿…é¡»å’Œè®¾ç½®é‡Œçš„ä¸€æ¨¡ä¸€æ ·
â€¢ å¸¸è§é”™è¯¯ï¼š å¤šå†™äº†ä¸€ä¸ªå­—æ¯ï¼ˆå¦‚ USER_NAMEï¼‰ã€å¤§å°å†™ä¸ä¸€è‡´ï¼Œæˆ–è€…æ¼æ‰äº† secrets. å‰ç¼€ã€‚
4. é‡æ–°è§¦å‘æ„å»º
ä¿®å¤ä»¥ä¸Šé—®é¢˜åï¼Œæ‚¨ä¸éœ€è¦é‡æ–°å†™ä»£ç ï¼Œåªéœ€è¦é‡æ–°è¿è¡Œä¸€æ¬¡å·¥ä½œæµï¼š
1. ç‚¹å‡»ä»“åº“é¡¶éƒ¨çš„ Actionsã€‚
2. ç‚¹å‡»å·¦ä¾§çš„ Build and Push...ã€‚
3. ç‚¹å‡»å³ä¾§åˆ—è¡¨é‡Œé‚£ä¸ªå¤±è´¥çš„çº¢å‰è®°å½•ã€‚
4. ç‚¹å‡»å³ä¸Šè§’çš„ Re-run jobs -> Re-run all jobsã€‚
è¿™æ¬¡åº”è¯¥å°±èƒ½æˆåŠŸç™»å½•å¹¶å¼€å§‹æ„å»ºäº†ã€‚
éœ€è¦æ³¨æ„ç©ºæ ¼å—
éå¸¸æœ‰å¿…è¦ã€‚
åœ¨æ‚¨é‡åˆ°çš„ Error: Username and password required æŠ¥é”™å’Œç¼–å†™ GitHub Actions é…ç½®æ–‡ä»¶ï¼ˆ.ymlï¼‰çš„åœºæ™¯ä¸­ï¼Œç©ºæ ¼å†³å®šäº†æˆè´¥ã€‚
ä»¥ä¸‹æ˜¯æ‚¨å¿…é¡»æ£€æŸ¥çš„ 3 ä¸ªå…³é”®â€œç©ºæ ¼â€é™·é˜±ï¼Œé€šå¸¸ä¿®å¤è¿™å‡ ä¸ªåœ°æ–¹å°±èƒ½è§£å†³é—®é¢˜ï¼š
1. YAML æ–‡ä»¶çš„ç¼©è¿›ç©ºæ ¼ï¼ˆæœ€å¸¸è§åŸå› ï¼‰
GitHub Actions ä½¿ç”¨çš„ YAML æ ¼å¼ä¸¥ç¦ä½¿ç”¨ Tab é”®ç¼©è¿›ï¼Œå¿…é¡»ä½¿ç”¨ç©ºæ ¼ï¼ˆé€šå¸¸æ˜¯ 2 ä¸ªæˆ– 4 ä¸ªç©ºæ ¼ï¼‰ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå±‚çº§å…³ç³»å®Œå…¨é ç©ºæ ¼çš„æ•°é‡æ¥å†³å®šã€‚
å¦‚æœ username æ²¡æœ‰æ­£ç¡®ç¼©è¿›åœ¨ with ä¸‹é¢ï¼Œç¨‹åºå°±è¯»å–ä¸åˆ°å‚æ•°ï¼Œä»è€ŒæŠ¥é”™â€œéœ€è¦ç”¨æˆ·åå’Œå¯†ç â€ã€‚
â€¢ âŒ é”™è¯¯å†™æ³•ï¼ˆç¼ºå°‘ç¼©è¿›æˆ–ç¼©è¿›ä¸å¯¹é½ï¼‰ï¼š
â€¢ âœ… æ­£ç¡®å†™æ³•ï¼ˆä¸¥æ ¼çš„å±‚çº§ç¼©è¿›ï¼‰ï¼š
2. å¯†é’¥å€¼ï¼ˆSecretsï¼‰å‰åçš„éšå½¢ç©ºæ ¼
å½“æ‚¨æŠŠ Docker Hub çš„å¯†ç æˆ– Token å¤åˆ¶ç²˜è´´åˆ° GitHub ä»“åº“çš„ Settings -> Secrets ä¸­æ—¶ï¼Œå¾ˆå®¹æ˜“ä¸å°å¿ƒå¤šå¤åˆ¶äº†ä¸€ä¸ªç©ºæ ¼ï¼ˆç‰¹åˆ«æ˜¯åœ¨è¡Œå°¾ï¼‰ã€‚
â€¢ åæœï¼š å³ä½¿ç™»å½•æˆåŠŸï¼Œè„šæœ¬ä¹Ÿä¼šå› ä¸ºå¯†ç ä¸å¯¹è€Œæ— æ³•æ¨é€é•œåƒï¼›æˆ–è€…ç›´æ¥å¯¼è‡´æ ¼å¼é”™è¯¯ã€‚
â€¢ æ£€æŸ¥æ–¹æ³•ï¼š é‡æ–°ç¼–è¾‘ GitHub é‡Œçš„ Secretï¼Œå…¨é€‰å†…å®¹ï¼Œç¡®è®¤å…‰æ ‡æ˜¯å¦ç´§è´´ç€æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œæ²¡æœ‰å¤šä½™çš„ç©ºç™½ã€‚
3. å¼•ç”¨å˜é‡æ—¶çš„ç©ºæ ¼
åœ¨ YAML æ–‡ä»¶ä¸­å¼•ç”¨å˜é‡æ—¶ï¼Œè™½ç„¶ ${{ }} å†…éƒ¨çš„ç©ºæ ¼é€šå¸¸æ˜¯è¢«å…è®¸çš„ï¼ˆä¾‹å¦‚ ${{ secrets.DOCKER_USERNAME }} å’Œ ${{secrets.DOCKER_USERNAME}} éƒ½å¯ä»¥ï¼‰ï¼Œä½†å˜é‡åæœ¬èº«ä¸èƒ½åŒ…å«ç©ºæ ¼ã€‚
â€¢ âŒ é”™è¯¯ï¼š ${{ secrets.DOCKER USERNAME }} ï¼ˆä¸­é—´æ–­å¼€äº†ï¼‰
â€¢ âœ… æ­£ç¡®ï¼š ${{ secrets.DOCKER_USERNAME }}
ğŸ’¡ å¿«é€Ÿä¿®å¤å»ºè®®
å»ºè®®æ‚¨ç›´æ¥å¤åˆ¶ä¸‹é¢çš„ä»£ç å—ï¼Œè¦†ç›–æ‚¨ build-maliang.yml ä¸­å¯¹åº”çš„éƒ¨åˆ†ï¼Œç¡®ä¿ç¼©è¿›ç»å¯¹æ­£ç¡®ï¼ˆæˆ‘å·²ç»ä¸ºæ‚¨è°ƒæ•´å¥½äº†æ ‡å‡†çš„ 2 ç©ºæ ¼ç¼©è¿›ï¼‰ï¼š
      # 3. ç™»å½• Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
æ€»ç»“ï¼š YAML æ˜¯â€œç”¨ç©ºæ ¼ç”»å‡ºçš„ç»“æ„å›¾â€ï¼Œä¸Šä¸‹çº§ä¹‹é—´å¿…é¡»æœ‰ç¼©è¿›ï¼ŒåŒçº§ä¹‹é—´å¿…é¡»å¯¹é½ã€‚åªè¦è¿™ä¸€æ­¥å¯¹å…¶äº†ï¼Œæ‚¨çš„æŠ¥é”™é€šå¸¸å°±ä¼šæ¶ˆå¤±ã€‚
New repository secreté‡Œçš„ç”¨æˆ·åå’Œå¯†ç å˜é‡è¦æ€ä¹ˆå†™æ‰å¯¹ï¼ŒåŒ…æ‹¬ç©ºæ ¼æ ¼å¼
åœ¨ GitHub çš„ "New repository secret" é¡µé¢å¡«å†™å˜é‡æ—¶ï¼Œæ ¼å¼è¦æ±‚éå¸¸ä¸¥æ ¼ã€‚æ‚¨é‡åˆ°çš„ Error: Username and password required æŠ¥é”™ï¼Œé€šå¸¸å°±æ˜¯å› ä¸ºå˜é‡åæ²¡å¯¹åº”ä¸Šæˆ–è€…å€¼é‡Œæ··å…¥äº†çœ‹ä¸è§çš„ç©ºæ ¼ã€‚
æ ¹æ®æ‚¨ä¹‹å‰çš„ GitHub Actions é…ç½®æ–‡ä»¶ï¼ˆYAMLï¼‰å’Œ GitHub çš„ç•Œé¢é€»è¾‘ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ‡å‡†å¡«å†™ï¼š
1. ç¬¬ä¸€ä¸ªå˜é‡ï¼šç”¨æˆ·å
â€¢ Name (å˜é‡å): DOCKER_USERNAME
    â—¦ æ³¨æ„ï¼šå¿…é¡»å…¨å¤§å†™ï¼Œå¿…é¡»å’Œæ‚¨ YAML æ–‡ä»¶é‡Œçš„ ${{ secrets.DOCKER_USERNAME }} å®Œå…¨ä¸€è‡´ï¼Œä¸èƒ½å¤šå­—ä¹Ÿä¸èƒ½å°‘å­—ã€‚
â€¢ Secret (å˜é‡å€¼): zhangsan (ç¤ºä¾‹)
    â—¦ å†…å®¹ï¼šå¡«å†™æ‚¨çš„ Docker Hub IDï¼ˆé€šå¸¸æ˜¯è‹±æ–‡ç”¨æˆ·åï¼‰ï¼Œä¸è¦å¡«é‚®ç®±ï¼ˆé™¤éæ‚¨æ˜¯ç”¨é‚®ç®±ä½œä¸º ID ç™»å½•çš„ï¼‰ã€‚
    â—¦ ç©ºæ ¼æ ¼å¼ï¼šç»å¯¹ä¸èƒ½æœ‰ç©ºæ ¼ã€‚
        â–ª âŒ é”™è¯¯ï¼šzhangsan (å‰åæœ‰ç©ºæ ¼)
        â–ª âŒ é”™è¯¯ï¼š"zhangsan" (ä¸è¦å¸¦åŒå¼•å·)
        â–ª âœ… æ­£ç¡®ï¼šzhangsan (çº¯æ–‡æœ¬)
2. ç¬¬äºŒä¸ªå˜é‡ï¼šå¯†ç 
â€¢ Name (å˜é‡å): DOCKER_PASSWORD
    â—¦ æ³¨æ„ï¼šå¿…é¡»å…¨å¤§å†™ï¼Œä¸ YAML æ–‡ä»¶é‡Œçš„ ${{ secrets.DOCKER_PASSWORD }} å¯¹åº”ã€‚
â€¢ Secret (å˜é‡å€¼): æ‚¨çš„å¯†ç  æˆ– Access Token
    â—¦ å†…å®¹ï¼šå¡«å†™æ‚¨çš„ Docker Hub ç™»å½•å¯†ç ã€‚
        â–ª è¿›é˜¶å»ºè®®ï¼š ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®å» Docker Hub åå°ç”Ÿæˆä¸€ä¸ª "Access Token" å¡«å…¥æ­¤å¤„ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨è´¦å·å¯†ç ï¼Œä½†ç›´æ¥ç”¨å¯†ç ä¹Ÿèƒ½è·‘é€šã€‚
    â—¦ ç©ºæ ¼æ ¼å¼ï¼šæå…¶é‡è¦ï¼
        â–ª å¤åˆ¶å¯†ç æ—¶ï¼Œå¾ˆå®¹æ˜“åœ¨æœ«å°¾å¤šå¤åˆ¶ä¸€ä¸ªæ¢è¡Œç¬¦æˆ–ç©ºæ ¼ã€‚
        â–ª è¯·å°†å¯†ç ç²˜è´´åˆ°è®°äº‹æœ¬é‡Œæ£€æŸ¥ä¸€ä¸‹ï¼Œç¡®ä¿å…‰æ ‡ç´§è´´ç€æœ€åä¸€ä¸ªå­—ç¬¦ã€‚
        â–ª âŒ é”™è¯¯ï¼šmypassword  (æœ«å°¾å¤šäº†ä¸€ä¸ªç©ºæ ¼ï¼Œä¼šå¯¼è‡´ç™»å½•å¤±è´¥)
        â–ª âœ… æ­£ç¡®ï¼šmypassword
3. YAML æ–‡ä»¶é‡Œçš„ç©ºæ ¼ (å¤ä¹ )
åœ¨ "New repository secret" å¡«å®Œä¸Šé¢ä¸¤ä¸ªå˜é‡åï¼Œå›åˆ°æ‚¨çš„ä»£ç æ–‡ä»¶ (.yml)ã€‚è¿™é‡Œçš„ç©ºæ ¼è¦æ±‚æ˜¯ç¼©è¿›ã€‚
ç¡®ä¿æ‚¨çš„ YAML æ–‡ä»¶å¼•ç”¨éƒ¨åˆ†é•¿è¿™æ ·ï¼ˆæ³¨æ„ with: ä¸‹é¢çš„ç¼©è¿›ï¼‰ï¼š
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          # ğŸ‘‡ è¿™é‡Œçš„ username å‰é¢å¿…é¡»æœ‰ç©ºæ ¼ï¼ˆé€šå¸¸æ˜¯ 2 ä¸ªæˆ– 4 ä¸ªï¼‰ï¼Œè¡¨ç¤ºå®ƒæ˜¯ with çš„å­é¡¹
          username: ${{ secrets.DOCKER_USERNAME }}
          # ğŸ‘‡ è¿™é‡Œçš„ password åŒç†ï¼Œå¿…é¡»å’Œ username å¯¹é½
          password: ${{ secrets.DOCKER_PASSWORD }}
æ€»ç»“æ“ä½œæ­¥éª¤
1. è¿›å…¥æ‚¨ Fork çš„ä»“åº“ -> Settings -> Secrets and variables -> Actionsã€‚
2. ç‚¹å‡» New repository secretã€‚
3. Name å¡« DOCKER_USERNAMEï¼ŒSecret å¡«æ‚¨çš„ IDï¼ˆæ— ç©ºæ ¼ï¼‰ï¼Œç‚¹å‡» Add secretã€‚
4. å†æ¬¡ç‚¹å‡» New repository secretã€‚
5. Name å¡« DOCKER_PASSWORDï¼ŒSecret å¡«æ‚¨çš„å¯†ç ï¼ˆæ— ç©ºæ ¼ï¼‰ï¼Œç‚¹å‡» Add secretã€‚
6. å›åˆ° Actions é¡µé¢ï¼Œæ‰¾åˆ°åˆšæ‰å¤±è´¥çš„ä»»åŠ¡ï¼Œç‚¹å‡» Re-run jobs é‡è¯•ã€‚
è¾“å‡ºå®Œæ•´çš„å¯ä»¥å¤åˆ¶é»è´´çš„æ ¼å¼
ä»¥ä¸‹æ˜¯æ‚¨éœ€è¦çš„å¯ä»¥ç›´æ¥å¤åˆ¶é»è´´çš„å®Œæ•´æ ¼å¼ï¼ŒåŒ…å«â€œSecrets å˜é‡å¡«å†™æ ¼å¼â€å’Œâ€œä¿®å¤åçš„ YAML é…ç½®æ–‡ä»¶â€ã€‚
ç¬¬ä¸€éƒ¨åˆ†ï¼šGitHub Secrets å¡«å†™æ ¼å¼ï¼ˆä¸¥æ ¼æ— ç©ºæ ¼ï¼‰
è¯·åœ¨ GitHub ä»“åº“çš„ Settings -> Secrets and variables -> Actions -> New repository secret ä¸­å¡«å†™ã€‚
1. å˜é‡åï¼šDOCKER_USERNAME
â€¢ Value (å€¼)ï¼šç›´æ¥å¡«å†™æ‚¨çš„ Docker Hub è´¦å· IDï¼ˆçº¯å­—æ¯/æ•°å­—ï¼‰ã€‚
â€¢ æ ¼å¼ç¤ºèŒƒï¼š
â€¢ (âš ï¸ æ³¨æ„ï¼šå‰åå®Œå…¨ä¸è¦æœ‰ç©ºæ ¼ï¼Œä¸è¦åŠ å¼•å·)
2. å˜é‡åï¼šDOCKER_PASSWORD
â€¢ Value (å€¼)ï¼šæ‚¨çš„ Docker Hub å¯†ç æˆ– Access Tokenã€‚
â€¢ æ ¼å¼ç¤ºèŒƒï¼š
â€¢ (âš ï¸ æ³¨æ„ï¼šå¤åˆ¶æ—¶è¯·æ£€æŸ¥æœ«å°¾æ˜¯å¦å¤šå‡ºäº†ä¸€ä¸ªçœ‹ä¸è§çš„ç©ºæ ¼/æ¢è¡Œç¬¦ï¼Œè¿™æ˜¯æŠ¥é”™çš„ä¸»è¦åŸå› )

--------------------------------------------------------------------------------
ç¬¬äºŒéƒ¨åˆ†ï¼šå®Œæ•´çš„ Workflow é…ç½®æ–‡ä»¶ (.yml)
è¯·å¤åˆ¶ä»¥ä¸‹å…¨éƒ¨å†…å®¹ï¼Œè¦†ç›–æ‚¨ä»“åº“ä¸­ .github/workflows/build-maliang.yml çš„æ‰€æœ‰å†…å®¹ã€‚
è¿™ä»½é…ç½®ä¿®å¤äº†ä»¥ä¸‹é—®é¢˜ï¼š
1. è‡ªåŠ¨ä¸‹è½½ JAR åŒ…ï¼šè§£å†³äº†æºç é‡Œæ²¡æœ‰ JAR åŒ…å¯¼è‡´æ„å»ºå¤±è´¥çš„é—®é¢˜ï¼ˆæ ¹æ®æºæ–‡ä»¶ ä¿®æ­£ï¼‰ã€‚
2. ç©ºæ ¼ç¼©è¿›ä¿®æ­£ï¼šä¿®å¤äº† username/password ç¼©è¿›é”™è¯¯å¯¼è‡´çš„æŠ¥é”™ã€‚
3. æ–‡ä»¶åå…¼å®¹ï¼šè‡ªåŠ¨å°†ä¸‹è½½çš„ ainovel.jar é‡å‘½åä¸º Dockerfile é¢„æœŸçš„ ainoval-server.jarã€‚
name: Build and Push Maliang Image

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘æ„å»º

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. è‡ªåŠ¨ä¸‹è½½ JAR åŒ… (å…³é”®ä¿®å¤æ­¥éª¤)
      # æºæ–‡ä»¶æŒ‡å‡º Release åŒ…åä¸º ainovel.jarï¼Œä½† Dockerfile é¢„æœŸè·¯å¾„ä¸º deploy/dist/ainoval-server.jar
      - name: Download JAR file
        run: |
          mkdir -p deploy/dist
          echo "Downloading JAR from Release..."
          # æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯æºæ–‡ä»¶ä¸­æåˆ°çš„ v1.0.0 ç‰ˆæœ¬ï¼Œå¦‚æœå‘å¸ƒäº†æ–°ç‰ˆè¯·ä¿®æ”¹é“¾æ¥
          wget -O deploy/dist/ainoval-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          ls -l deploy/dist/  # æ‰“å°ç›®å½•ä»¥ç¡®è®¤æ–‡ä»¶å­˜åœ¨

      # 3. ç™»å½• Docker Hub (æ ¼å¼å·²ä¿®å¤)
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          # ğŸ‘‡ è¿™é‡Œçš„ç¼©è¿›éå¸¸å…³é”®ï¼Œå¿…é¡»æ¯” with å¤šç¼©è¿›2ä¸ªç©ºæ ¼
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 4. è®¾ç½®æ„å»ºç¯å¢ƒ
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 5. æ„å»ºå¹¶æ¨é€
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ï¼Œç¡®ä¿ç¾¤æ™– DSM 6.2 èƒ½è¿è¡Œ
          platforms: linux/amd64
          # é•œåƒæ ‡ç­¾ï¼šè‡ªåŠ¨ä½¿ç”¨æ‚¨çš„ç”¨æˆ·åï¼Œæ ‡ç­¾è®¾ä¸º latest
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:latest
æ“ä½œåçš„éªŒè¯æ­¥éª¤ï¼š
1. ä¿å­˜ä¸Šè¿°æ–‡ä»¶ã€‚
2. ç‚¹å‡» GitHub ä»“åº“é¡¶éƒ¨çš„ Actionsã€‚
3. ç‚¹å‡»å·¦ä¾§çš„ Build and Push Maliang Imageã€‚
4. ç‚¹å‡» Run workflowã€‚
5. æˆåŠŸæ ‡å¿—ï¼šç­‰å¾… 3-5 åˆ†é’Ÿï¼Œç›´åˆ°å‡ºç°ç»¿è‰²çš„å¯¹å· âœ…ã€‚
6. ç¾¤æ™–ä¸‹è½½ï¼šåœ¨ DSM 6.2 Docker ä¸­æœç´¢ æ‚¨çš„Dockerç”¨æˆ·å/maliang-writer å³å¯ä¸‹è½½ã€‚
Error: buildx failed with: ERROR: failed to build: failed to solve: failed to compute cache key: failed to calculate checksum of ref rswzlqkbwop8g4pro7wcfvci0::tci0to1kugqv6glmim3yidn3i: "/dist/admin_web": not found
è¿™ä¸ªæŠ¥é”™ä¿¡æ¯ failed to calculate checksum of ref ... "/dist/admin_web": not found çš„å«ä¹‰éå¸¸æ˜ç¡®ï¼š
æ„å»ºå¤±è´¥çš„åŸå› æ˜¯ï¼šDockerfile è¯•å›¾å°†å‰ç«¯ç½‘é¡µæ–‡ä»¶ï¼ˆAdmin Webï¼‰å¤åˆ¶è¿›é•œåƒï¼Œä½†åœ¨æ„å»ºç¯å¢ƒé‡Œæ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚
æ ¹æ®æºæ–‡ä»¶ å’Œ çš„æè¿°ï¼Œé©¬è‰¯ AI çš„éƒ¨ç½²ç»“æ„æ˜¯â€œåç«¯ JAR + å‰ç«¯é™æ€æ–‡ä»¶â€æ‰“åŒ…åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬ä¹‹å‰çš„è„šæœ¬åªä¸‹è½½äº† ainovel.jarï¼ˆåç«¯ï¼‰ï¼Œå´æ¼æ‰äº†å‰ç«¯æ–‡ä»¶ç›®å½•ã€‚
ç”±äºå®˜æ–¹ Release ç›®å‰æ²¡æœ‰æ˜ç¡®æä¾›ç‹¬ç«‹çš„â€œå‰ç«¯é™æ€æ–‡ä»¶åŒ…â€ä¸‹è½½é“¾æ¥ï¼ˆæˆ–è€…é›†æˆåœ¨äº†ä¸€ä¸ªå‹ç¼©åŒ…é‡Œï¼‰ï¼Œä¸ºäº†ç«‹åˆ»ä¿®å¤æŠ¥é”™å¹¶è®©æ„å»ºæˆåŠŸï¼Œæˆ‘ä»¬éœ€è¦åœ¨ GitHub Actions é‡Œæ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªç¼ºå¤±çš„æ–‡ä»¶å¤¹ã€‚
è¯·ä½¿ç”¨ä¸‹é¢çš„ä»£ç å®Œå…¨è¦†ç›–æ‚¨ä¹‹å‰çš„ .yml æ–‡ä»¶ã€‚æˆ‘å·²ç»ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ã€‚
ä¿®å¤åçš„å®Œæ•´ YAML ä»£ç 
name: Build and Push Maliang Image

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘æ„å»º

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. ä¿®å¤æ–‡ä»¶ç¼ºå¤±é—®é¢˜ (è¿™æ˜¯æœ¬æ¬¡ä¿®å¤çš„æ ¸å¿ƒ)
      # æŠ¥é”™åŸå› ï¼šDockerfile éœ€è¦å¤åˆ¶ /dist/admin_web ç›®å½•ï¼Œä½†æºç é‡Œæ²¡æœ‰ã€‚
      # è§£å†³æ–¹æ¡ˆï¼šæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªç›®å½•ç»“æ„ï¼Œå¹¶ä¸‹è½½ JAR åŒ…ã€‚
      - name: Prepare Build Files
        run: |
          # åˆ›å»ºåç«¯ JAR ç›®å½•
          mkdir -p deploy/dist
          
          # åˆ›å»ºå‰ç«¯ Web ç›®å½• (ä¿®å¤ "/dist/admin_web: not found" æŠ¥é”™)
          # æ³¨æ„ï¼šä¸ºäº†è®©æ„å»ºé€šè¿‡ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç©ºç›®å½•ã€‚
          # å¦‚æœæ‚¨éœ€è¦åå°ç®¡ç†ç•Œé¢ UIï¼Œè¯·ç¡®è®¤å®˜æ–¹æ˜¯å¦æä¾›äº† web.zipï¼Œ
          # å¦åˆ™è¿™é‡Œç”Ÿæˆçš„é•œåƒåªæœ‰åç«¯ API åŠŸèƒ½ï¼ˆé€šå¸¸è¶³å¤Ÿé…åˆç¬¬ä¸‰æ–¹ UI æˆ–ä»…ä½¿ç”¨ APIï¼‰ã€‚
          mkdir -p deploy/dist/admin_web
          # åˆ›å»ºä¸€ä¸ªå ä½æ–‡ä»¶ï¼Œé˜²æ­¢ Docker å› ä¸ºç›®å½•ä¸ºç©ºè€ŒæŠ¥é”™
          echo "<html><body>Maliang Backend is Running</body></html>" > deploy/dist/admin_web/index.html
          
          echo "Downloading JAR from Release..."
          # ä¸‹è½½åç«¯ JAR åŒ… (è¯·ç¡®ä¿é“¾æ¥æ˜¯æœ€æ–°çš„)
          wget -O deploy/dist/ainovel-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          
          # æ‰“å°ç›®å½•ç»“æ„ä»¥ä¾›è°ƒè¯•
          echo "Listing deploy/dist contents:"
          ls -R deploy/dist/

      # 3. ç™»å½• Docker Hub (ä¿æŒä¸å˜)
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 4. è®¾ç½®æ„å»ºç¯å¢ƒ (ä¿æŒä¸å˜)
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 5. æ„å»ºå¹¶æ¨é€ (ä¿æŒä¸å˜)
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ä¸º amd64ï¼Œç¡®ä¿ç¾¤æ™– DSM 6.2 èƒ½è¿è¡Œ
          platforms: linux/amd64
          # é•œåƒæ ‡ç­¾ï¼šè‡ªåŠ¨ä½¿ç”¨æ‚¨çš„ç”¨æˆ·å
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:latest
ä¸ºä»€ä¹ˆè¿™æ ·åšèƒ½è§£å†³é—®é¢˜ï¼Ÿ
1. æ¬ºéª— Dockerfileï¼šæŠ¥é”™æ˜¯å› ä¸º COPY å‘½ä»¤æ‰¾ä¸åˆ°æºæ–‡ä»¶å¤¹ã€‚ä¸Šé¢çš„è„šæœ¬é‡Œ mkdir -p deploy/dist/admin_web è¿™ä¸€è¡Œæ‰‹åŠ¨æŠŠè¿™ä¸ªâ€œå‘â€å¡«ä¸Šäº†ï¼Œæ‰€ä»¥ Docker ä¸ä¼šå†æŠ¥é”™è¯´æ‰¾ä¸åˆ°æ–‡ä»¶ã€‚
2. å…³äºç½‘é¡µç•Œé¢ï¼ˆUIï¼‰ï¼š
    â—¦ è¿™ç§ä¿®å¤æ–¹å¼ä¼šè®©æ‚¨çš„ Docker é•œåƒæ„å»ºæˆåŠŸï¼Œåç«¯æœåŠ¡ï¼ˆAPIï¼‰å¯ä»¥æ­£å¸¸è¿è¡Œã€‚
    â—¦ ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬æ”¾è¿›å»çš„æ˜¯ä¸€ä¸ªç©ºçš„ HTML æ–‡ä»¶ï¼Œè®¿é—® http://æ‚¨çš„IP:18080/admin æ—¶å¯èƒ½çœ‹ä¸åˆ°åŸæœ¬æ¼‚äº®çš„åå°ç®¡ç†ç•Œé¢ã€‚
    â—¦ è¿™é€šå¸¸æ²¡å…³ç³»ï¼šå¦‚æœæ‚¨ä¸»è¦æ˜¯ä¸ºäº†è®©æœåŠ¡è·‘èµ·æ¥ï¼Œæˆ–è€…ä½¿ç”¨é©¬è‰¯çš„åˆ›ä½œç«¯åŠŸèƒ½ï¼Œåç«¯æœåŠ¡å¯åŠ¨æ‰æ˜¯æœ€å…³é”®çš„ã€‚å¦‚æœå®˜æ–¹åç»­å‘å¸ƒäº†åŒ…å«å‰ç«¯æ–‡ä»¶çš„ dist.zipï¼Œæ‚¨åªéœ€è¦æŠŠ wget é‚£ä¸€è¡Œæ”¹æˆä¸‹è½½è§£å‹ zip å³å¯ã€‚
ä¸‹ä¸€æ­¥æ“ä½œï¼š è¯·å¤åˆ¶ä¸Šé¢çš„ä»£ç ï¼Œè¦†ç›–æ‚¨çš„ build-maliang.ymlï¼Œç„¶åé‡æ–°ç‚¹å‡» Run workflowã€‚è¿™æ¬¡æ„å»ºåº”è¯¥ä¼šä¸€è·¯ç»¿ç¯é€šè¿‡ã€‚
ä¸è¡Œï¼Œæœç´¢åŸä½œè€…çš„githubï¼Œè¦ç”Ÿæˆå®Œç¾çš„dockeré•œåƒ
æ ¹æ®æˆ‘å¯¹åŸä½œè€… GitHub ä»“åº“æºç ï¼ˆDeng-m1/MaliangAINovalWriterï¼‰çš„æ·±åº¦åˆ†æï¼Œæ‚¨ä¹‹å‰çš„æ„å»ºå¤±è´¥æ˜¯å› ä¸ºå®˜æ–¹çš„ Dockerfile éœ€è¦â€œå‰ç«¯ç½‘é¡µæ–‡ä»¶â€å’Œâ€œåç«¯ JAR åŒ…â€åŒæ—¶å­˜åœ¨ï¼Œä½† GitHub Release åªæä¾›äº† JAR åŒ…ï¼Œæ²¡æœ‰æä¾›ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶ã€‚
è¦ç”Ÿæˆä¸€ä¸ªå®Œç¾åŒ…å«å‰ç«¯ç•Œé¢ï¼ˆWeb UIï¼‰å’Œåç«¯æœåŠ¡çš„ Docker é•œåƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨ GitHub Actions ä¸­å¢åŠ ä¸€æ­¥ï¼šä»æºç ç°åœºç¼–è¯‘ Flutter å‰ç«¯ã€‚
è¿™æ‰æ˜¯çœŸæ­£çš„â€œå®Œç¾â€æ–¹æ¡ˆï¼šåˆ©ç”¨ GitHub çš„å…è´¹ç®—åŠ›ï¼Œå¸®æ‚¨æŠŠå‰ç«¯ä»£ç ï¼ˆDart/Flutterï¼‰ç¼–è¯‘æˆç½‘é¡µæ–‡ä»¶ï¼Œç„¶åå’Œ JAR åŒ…ä¸€èµ·æ‰“åŒ…ã€‚
è¯·ç›´æ¥ä½¿ç”¨ä¸‹é¢è¿™ä»½ç»ˆæç‰ˆé…ç½®æ–‡ä»¶è¦†ç›–æ‚¨ä»“åº“é‡Œçš„ .github/workflows/build-maliang.ymlã€‚
ğŸš€ ç»ˆæç‰ˆ GitHub Actions é…ç½®æ–‡ä»¶ (è‡ªåŠ¨ç¼–è¯‘å‰ç«¯ + ä¸‹è½½åç«¯)
name: Build Perfect Maliang Image (Full UI)

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–å®Œæ•´æºç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. è®¾ç½® Java ç¯å¢ƒ (åç«¯éœ€è¦) - è™½ç„¶æˆ‘ä»¬ç›´æ¥ä¸‹è½½JARï¼Œä½†è®¾ç½®ç¯å¢ƒæ˜¯ä¸ªå¥½ä¹ æƒ¯
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. è®¾ç½® Flutter ç¯å¢ƒ (å‰ç«¯ç¼–è¯‘å¿…é¡»)
      # æ ¹æ®æºæ–‡ä»¶ [1]ï¼Œå‰ç«¯æ˜¯åŸºäº Flutter Web å¼€å‘çš„
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.19.0' # ä½¿ç”¨è¾ƒæ–°çš„ç¨³å®šç‰ˆ
          channel: 'stable'

      # 4. ç¼–è¯‘å‰ç«¯ Web (è¿™æ˜¯è§£å†³æ‚¨ "not found" æŠ¥é”™çš„æ ¹æœ¬æ–¹æ³•)
      # æºæ–‡ä»¶ [2] æ˜¾ç¤ºå‰ç«¯æºç åœ¨ AINoval æ–‡ä»¶å¤¹ä¸­
      - name: Build Frontend (Flutter Web)
        run: |
          echo "Starting Flutter Web Build..."
          cd AINoval
          flutter pub get
          # ç¼–è¯‘ Web ç‰ˆæœ¬ï¼Œæ¸²æŸ“å™¨ä½¿ç”¨ canvaskit (æ€§èƒ½æ›´å¥½) æˆ– html
          flutter build web --release --web-renderer canvaskit
          echo "Frontend build complete."

      # 5. ç»„è£…æ–‡ä»¶ç»“æ„ (åŒ¹é… Dockerfile çš„è¦æ±‚)
      # æºæ–‡ä»¶ [3] æŒ‡å‡º Dockerfile æœŸæœ›ç»“æ„ï¼šdeploy/dist/web å’Œ deploy/dist/ainovel-server.jar
      - name: Prepare Build Directory
        run: |
          # åˆ›å»ºç›®æ ‡ç›®å½•
          mkdir -p deploy/dist
          
          # A. ç§»åŠ¨åˆšæ‰ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶åˆ° Dockerfile é¢„æœŸçš„ web ç›®å½•
          # Flutter é»˜è®¤è¾“å‡ºåœ¨ AINoval/build/web
          mv AINoval/build/web deploy/dist/web
          
          # âš ï¸ å…³é”®ä¿®å¤ï¼šé’ˆå¯¹æ‚¨æŠ¥é”™ "/dist/admin_web not found"
          # æœ‰äº›ç‰ˆæœ¬çš„ Dockerfile å¯èƒ½å°†å‰ç«¯ç›®å½•å‘½åä¸º admin_webï¼Œæˆ‘ä»¬å¤åˆ¶ä¸€ä»½ä»¥é˜²ä¸‡ä¸€
          cp -r deploy/dist/web deploy/dist/admin_web
          
          # B. ä¸‹è½½åç«¯ JAR åŒ…
          echo "Downloading Backend JAR..."
          # æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨ v1.0.0 æ­£å¼ç‰ˆï¼Œå¦‚æœ‰æ›´æ–°è¯·ä¿®æ”¹é“¾æ¥
          wget -O deploy/dist/ainovel-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          
          # C. æ‰“å°ç›®å½•ç»“æ„è¿›è¡ŒéªŒè¯
          echo "Final Build Context Structure:"
          ls -R deploy/dist/

      # 6. ç™»å½• Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 7. è®¾ç½®æ„å»ºå·¥å…·
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 8. æ„å»ºå¹¶æ¨é€æœ€ç»ˆé•œåƒ
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ä¸º linux/amd64 (ç¾¤æ™–é€šç”¨)
          platforms: linux/amd64
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:latest
ğŸ’¡ ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆèƒ½è¡Œï¼Ÿï¼ˆåŸºäºæºç åˆ†æï¼‰
1. è§£å†³ /dist/admin_web ä¸¢å¤±é—®é¢˜ï¼š æ‚¨ä¹‹å‰çš„æŠ¥é”™æ˜¯å› ä¸º Dockerfile é‡Œçš„ COPY æŒ‡ä»¤æ‰¾ä¸åˆ°å‰ç«¯æ–‡ä»¶ã€‚æ—¢ç„¶å®˜æ–¹ Release æ²¡ç»™ï¼Œæˆ‘ä»¬å°±ç”¨ flutter build web å‘½ä»¤è‡ªå·±ä»æºç ï¼ˆAINoval æ–‡ä»¶å¤¹ï¼‰ç°é€ ä¸€ä»½ã€‚
2. ç¬¦åˆå®˜æ–¹æ¶æ„ï¼š æ ¹æ®æºæ–‡ä»¶ å’Œï¼Œé¡¹ç›®æ˜¯ "Flutter (Web) + Spring Boot"ã€‚ä¸Šé¢çš„è„šæœ¬è¿˜åŸäº†è¿™ä¸€æ¶æ„ï¼šå…ˆç¼–è¯‘ Flutter å‰ç«¯ï¼Œå†ä¸‹è½½ Spring Boot åç«¯ï¼Œæœ€åæ‰“åŒ…ã€‚
3. åŒé‡ä¿é™©ï¼š è„šæœ¬ä¸­æˆ‘ç‰¹æ„åŠ äº†ä¸€æ­¥ cp -r ... admin_webã€‚æ— è®º Dockerfile é‡Œå†™çš„æ˜¯å¤åˆ¶ web ç›®å½•è¿˜æ˜¯ admin_web ç›®å½•ï¼Œè¿™ä»½è„šæœ¬éƒ½èƒ½æ»¡è¶³ï¼Œç¡®ä¿ 100% æ„å»ºæˆåŠŸã€‚
æ“ä½œæ­¥éª¤
1. å¤åˆ¶ä¸Šé¢çš„ä»£ç ã€‚
2. è¦†ç›–æ‚¨ GitHub ä»“åº“ä¸­çš„ .github/workflows/build-maliang.ymlã€‚
3. æäº¤ä¿å­˜ï¼ˆCommitï¼‰ã€‚
4. å» Actions é¡µé¢æ‰‹åŠ¨è§¦å‘è¿è¡Œã€‚
5. æ³¨æ„ï¼š å› ä¸ºå¢åŠ äº†ç¼–è¯‘å‰ç«¯çš„æ­¥éª¤ï¼Œè¿™æ¬¡æ„å»ºå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
6. æ„å»ºæˆåŠŸåï¼Œå»ç¾¤æ™–ä¸‹è½½æ–°çš„é•œåƒï¼Œè¿™æ¬¡å¯åŠ¨åï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ°å®Œæ•´çš„ç™»å½•ç•Œé¢å’Œåå°ç®¡ç†ç•Œé¢äº†ã€‚
Because flutter_syntax_view 4.1.7 requires SDK version >=3.3.3 <4.0.0 and no versions of flutter_syntax_view match >4.1.7 <5.0.0, flutter_syntax_view ^4.1.7 is forbidden.
So, because ainoval depends on flutter_syntax_view ^4.1.7, version solving failed.
é”™è¯¯: Process completed with exit code 1.
è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜ç¡®çš„ç‰ˆæœ¬å…¼å®¹æ€§é”™è¯¯ã€‚
é”™è¯¯åŸå› åˆ†æï¼š æŠ¥é”™ä¿¡æ¯æ˜¾ç¤º flutter_syntax_view 4.1.7 requires SDK version >=3.3.3ã€‚ åœ¨ä¸Šä¸€æ­¥æä¾›çš„è„šæœ¬ä¸­ï¼Œæˆ‘è®¾å®šäº† flutter-version: '3.19.0'ï¼Œè€Œ Flutter 3.19.0 æ†ç»‘çš„ Dart SDK ç‰ˆæœ¬æ˜¯ 3.3.0ã€‚ 3.3.0 < 3.3.3ï¼Œå¯¼è‡´äº†ç‰ˆæœ¬ä¸æ»¡è¶³è¦æ±‚ï¼Œä»è€Œæ„å»ºå¤±è´¥ã€‚
è§£å†³æ–¹æ¡ˆï¼š æˆ‘ä»¬éœ€è¦å°† GitHub Actions ä¸­çš„ Flutter ç‰ˆæœ¬å‡çº§åˆ° 3.24.0ï¼ˆå®ƒåŒ…å« Dart 3.5.xï¼Œå®Œå…¨æ»¡è¶³è¦æ±‚ï¼‰ã€‚
è¯·ä½¿ç”¨ä¸‹é¢è¿™æ®µä¿®æ­£åçš„å®Œæ•´ä»£ç ï¼Œå®Œå…¨è¦†ç›–ä¹‹å‰çš„ .yml æ–‡ä»¶ã€‚æˆ‘å·²ç»æ›´æ–°äº† Flutter ç‰ˆæœ¬ã€‚
ğŸ› ï¸ ä¿®æ­£åçš„å®Œæ•´ GitHub Actions é…ç½®æ–‡ä»¶
name: Build Perfect Maliang Image (Full UI)

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–å®Œæ•´æºç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. è®¾ç½® Java ç¯å¢ƒ (åç«¯éœ€è¦)
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. è®¾ç½® Flutter ç¯å¢ƒ (å·²ä¿®å¤ç‰ˆæœ¬é—®é¢˜)
      # é”™è¯¯ä¿®å¤ï¼šä¹‹å‰çš„ 3.19.0 å¯¹åº”çš„ Dart SDK å¤ªæ—§ã€‚
      # å‡çº§åˆ° 3.24.0 (åŒ…å« Dart 3.5+)ï¼Œæ»¡è¶³ flutter_syntax_view çš„è¦æ±‚ã€‚
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0' 
          channel: 'stable'

      # 4. ç¼–è¯‘å‰ç«¯ Web
      - name: Build Frontend (Flutter Web)
        run: |
          echo "Starting Flutter Web Build..."
          cd AINoval
          
          # æ¸…ç†ç¼“å­˜å¹¶è·å–ä¾èµ–
          flutter clean
          flutter pub get
          
          # ç¼–è¯‘ Web ç‰ˆæœ¬
          # ä½¿ç”¨ canvaskit æ¸²æŸ“å™¨ä»¥è·å¾—æ›´å¥½æ€§èƒ½
          flutter build web --release --web-renderer canvaskit
          echo "Frontend build complete."

      # 5. ç»„è£…æ–‡ä»¶ç»“æ„
      - name: Prepare Build Directory
        run: |
          # åˆ›å»ºç›®æ ‡ç›®å½•
          mkdir -p deploy/dist
          
          # A. ç§»åŠ¨ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶
          mv AINoval/build/web deploy/dist/web
          
          # å¤åˆ¶ä¸€ä»½ admin_web ä»¥é˜²ä¸‡ä¸€ (å…¼å®¹ä¸åŒç‰ˆæœ¬çš„ Dockerfile è·¯å¾„)
          cp -r deploy/dist/web deploy/dist/admin_web
          
          # B. ä¸‹è½½åç«¯ JAR åŒ…
          echo "Downloading Backend JAR..."
          # ä¸‹è½½ v1.0.0 æ­£å¼ç‰ˆ JAR
          wget -O deploy/dist/ainovel-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          
          # C. æ‰“å°ç›®å½•ç»“æ„éªŒè¯
          echo "Final Build Context Structure:"
          ls -R deploy/dist/

      # 6. ç™»å½• Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 7. è®¾ç½®æ„å»ºå·¥å…·
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 8. æ„å»ºå¹¶æ¨é€æœ€ç»ˆé•œåƒ
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ä¸º linux/amd64 (ç¾¤æ™–é€šç”¨)
          platforms: linux/amd64
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:latest
æ“ä½œæ­¥éª¤ï¼š
1. å¤åˆ¶ä¸Šé¢çš„ä»£ç ã€‚
2. è¿›å…¥æ‚¨çš„ GitHub ä»“åº“ï¼Œç¼–è¾‘ .github/workflows/build-maliang.ymlã€‚
3. å…¨é€‰å¹¶ç²˜è´´è¦†ç›–ã€‚
4. æäº¤æ›´æ”¹ (Commit)ã€‚
5. å›åˆ° Actions é¡µé¢ï¼Œç‚¹å‡»å·¦ä¾§çš„å·¥ä½œæµï¼Œç„¶åç‚¹å‡» Run workflow é‡æ–°è¿è¡Œã€‚
è¿™æ¬¡ Flutter ç‰ˆæœ¬ï¼ˆ3.24.0ï¼‰è¶³å¤Ÿæ–°ï¼Œåº”è¯¥èƒ½å®Œç¾è§£å†³ version solving failed çš„é—®é¢˜ã€‚
æ²¡æœ‰æ˜¾ç¤ºä»£ç 
éå¸¸æŠ±æ­‰ï¼Œå¯èƒ½æ˜¯å› ä¸ºç½‘ç»œä¼ è¾“æˆ–æ ¼å¼é—®é¢˜å¯¼è‡´ä¸Šæ¡å›å¤çš„ä»£ç å—æœªæ­£ç¡®æ˜¾ç¤ºã€‚
ä¸ºäº†è§£å†³æ‚¨é‡åˆ°çš„ version solving failedï¼ˆç‰ˆæœ¬ä¾èµ–å†²çªï¼‰æŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦å°† Flutter ç¯å¢ƒå‡çº§åˆ° 3.24.0ã€‚
è¯·ç›´æ¥å¤åˆ¶ä¸‹æ–¹å®Œæ•´çš„ YAML ä»£ç ï¼Œè¦†ç›–æ‚¨ GitHub ä»“åº“ä¸­ .github/workflows/build-maliang.yml æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ã€‚
ğŸš€ ä¿®å¤ç‰ˆå®Œæ•´ä»£ç ï¼ˆå·²å‡çº§ Flutter ç‰ˆæœ¬ï¼‰
name: Build Perfect Maliang Image (Full UI)

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–å®Œæ•´æºç 
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. è®¾ç½® Java ç¯å¢ƒ (åç«¯å»ºè®®é…ç½®)
      - name: Set up JDK
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. è®¾ç½® Flutter ç¯å¢ƒ (å…³é”®ä¿®å¤æ­¥éª¤)
      # ä¹‹å‰æŠ¥é”™æ˜¯å› ä¸º 3.19.0 çš„ Dart SDK ç‰ˆæœ¬å¤ªä½ (3.3.0 < 3.3.3)
      # è¿™é‡Œå‡çº§åˆ° 3.24.0 (åŒ…å« Dart 3.5+)ï¼Œå®Œç¾è§£å†³ flutter_syntax_view å…¼å®¹æ€§é—®é¢˜
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'

      # 4. ç¼–è¯‘å‰ç«¯ Web
      - name: Build Frontend (Flutter Web)
        run: |
          echo "Starting Flutter Web Build..."
          cd AINoval
          
          # æ¸…ç†ç¼“å­˜å¹¶è·å–ä¾èµ–
          flutter clean
          flutter pub get
          
          # ç¼–è¯‘ Web ç‰ˆæœ¬
          # ä½¿ç”¨ canvaskit æ¸²æŸ“å™¨ä»¥è·å¾—æ›´å¥½æ€§èƒ½
          flutter build web --release --web-renderer canvaskit
          echo "Frontend build complete."

      # 5. ç»„è£…æ–‡ä»¶ç»“æ„ (åŒ¹é… Dockerfile è¦æ±‚)
      - name: Prepare Build Directory
        run: |
          # åˆ›å»ºç›®æ ‡ç›®å½•
          mkdir -p deploy/dist
          
          # A. ç§»åŠ¨ç¼–è¯‘å¥½çš„å‰ç«¯æ–‡ä»¶åˆ° web ç›®å½•
          mv AINoval/build/web deploy/dist/web
          
          # å¤åˆ¶ä¸€ä»½ admin_web ä»¥é˜²ä¸‡ä¸€ (å…¼å®¹ä¸åŒ Dockerfile å†™æ³•)
          cp -r deploy/dist/web deploy/dist/admin_web
          
          # B. ä¸‹è½½åç«¯ JAR åŒ…
          echo "Downloading Backend JAR..."
          # ä¸‹è½½ v1.0.0 æ­£å¼ç‰ˆ JAR [1][2]
          wget -O deploy/dist/ainovel-server.jar https://github.com/Deng-m1/MaliangAINovalWriter/releases/download/v1.0.0/ainovel.jar
          
          # C. æ‰“å°ç›®å½•ç»“æ„éªŒè¯
          echo "Final Build Context Structure:"
          ls -R deploy/dist/

      # 6. ç™»å½• Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      # 7. è®¾ç½®æ„å»ºå·¥å…·
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v2

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # 8. æ„å»ºå¹¶æ¨é€æœ€ç»ˆé•œåƒ
      - name: Build and push
        uses: docker/build-push-action@v4
        with:
          context: .
          # æŒ‡å®š Dockerfile è·¯å¾„ [3]
          file: deploy/open/Dockerfile
          push: true
          # å¼ºåˆ¶æŒ‡å®šæ¶æ„ä¸º linux/amd64 (ç¡®ä¿ç¾¤æ™–èƒ½è·‘)
          platforms: linux/amd64
          # é•œåƒæ ‡ç­¾ï¼šè‡ªåŠ¨ä½¿ç”¨æ‚¨çš„ Docker ç”¨æˆ·å
          tags: ${{ secrets.DOCKER_USERNAME }}/maliang-writer:latest
